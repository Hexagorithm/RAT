#!/bin/bash
inputfile="/tmp/c0mmand.txt"
stdoutfile="/tmp/std0ut.txt"
stderrfile="/tmp/std3rr.txt"
inputport="12005"
outputport="12006"
errorport="12007"

echo "Awaiting command..."

nc -l -p "$inputport" > "$inputfile" & # initiate 1 nc connection, dont repeat it
while : ; do
	command="$(cat $inputfile)"	
	echo "" > $inputfile
	if [[ "$command" == "" ]] ; then
		echo -en "Nothing...\r"
	else 	
		echo "Command received: $command"
		break
	fi
done

pkill -P $$ nc
rm -f $inputfile

echo "Executing command"

eval "$command" > $stdoutfile 2> $stderrfile
echo -e "Output when executing $command;\n$(cat $stdoutfile)\n\n" | nc -l -p $outputport 
echo -e "Error when executing $command:\n$(cat $stdoutfile)\n\n" | nc -l -p $errorport
pkill -P $$ nc

rm -f $stdoutfile
rm -f $stderrfile

exit 0


